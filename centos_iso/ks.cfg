# Kickstart file automatically generated by anaconda.

install
text
#install from cd-rom
cdrom
lang zh_CN.UTF-8
keyboard us

# Skip the X Configuration
skipx

network --device eth0 --bootproto static --ip 192.168.1.26 --netmask 255.255.255.0 --gateway 192.168.1.1 --nameserver 8.8.8.8 --hostname haodou-centos-56-2.yongfu.com
rootpw --iscrypted $1$fNvcciaw$acmhMteupSzC.kjNmFYvx.
firewall --enabled --port=22:tcp --port=80:tcp
authconfig --enableshadow --enablemd5
selinux --disabled
timezone --utc Asia/Shanghai
bootloader --location=mbr
zerombr yes
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#clearpart --linux --drives=sda
#part /boot --fstype ext3 --size=100 --ondisk=sda
#part pv.2 --size=0 --grow --ondisk=sda
#volgroup VolGroup00 --pesize=32768 pv.2
#logvol / --fstype ext3 --name=LogVol00 --vgname=VolGroup00 --size=1024 --grow
#logvol swap --fstype swap --name=LogVol01 --vgname=VolGroup00 --size=752 --grow --maxsize=1504
clearpart --all --initlabel

#### virtual box partition ####
part /boot --fstype ext3 --size=100 --asprimary
part / --fstype ext3 --size=10000
part /data --fstype ext3 --size=1 --grow
part swap --size=752  --grow --maxsize=1500

#### real machine partition ####
#part /boot --fstype ext3 --size=100 --asprimary
#part / --fstype ext3 --size=20000
#part /data --fstype ext3 --size=1 --grow
#part swap --size=752  --grow --maxsize=16384

#### reboot the host after installation is done ####
reboot --eject

%packages
@base
@chinese-support
@core
@editors
kernel-devel
kernel-headers
gcc
gcc-c++
keyutils
iscsi-initiator-utils
trousers
fipscheck
device-mapper-multipath
-nss_db
-acpid
-nss_ldap
-pam_pkcs11
-readahead
-krb5-workstation
-ksh
-mcelog
-lftp
-crash
-aspell-en
-stunnel
-words
-coolkey
-aspell
-numactl
-mgetty
-fbset
-vconfig
-dump
-dosfstools
-mdadm
-libaio
-ftp
-nano
-irqbalance
-autofs
-sendmail
-rdate
-conman
-symlinks
-pcmciautils
-yum-updatesd
-redhat-lsb
-pam_ccreds
-mlocate
-pam_smb
-sos
-mtools
-pkinit-nss
-microcode_ctl
-firstboot-tui
-cpuspeed
-NetworkManager
-specspo
-rsh
-setuptool
-nfs-utils
-pinfo
-ipsec-tools
-rp-pppoe
-mtr
-mkbootdisk
-pam_krb5
-irda-utils
-pam_passwdqc
-amtu
-rng-utils
-ypbind
-jwhois
-rdist
-system-config-network-tui
-pax
-nc
-oddjob
-smartmontools
-wireless-tools
-ccid
-tcsh
-anacron
-setarch
-bluez-utils
-logwatch
-usbutils
-gnupg
-time
-talk


#
# ------- Begin cp Install.tar.gz ---------
#
%post --nochroot
# Mount CDROM
mkdir -p /mnt/cdrom
mount -r -t iso9660 /tmp/cdrom /mnt/cdrom
# Copy our tar file and extract it
cp /mnt/cdrom/Install.tar.gz /mnt/sysimage/tmp/Install.tar.gz > /dev/null
cd /mnt/sysimage/tmp/
tar -zxf Install.tar.gz > /dev/null
cp -R /mnt/sysimage/tmp/Install /mnt/sysimage/data/ >/dev/null
umount /mnt/cdrom

%post
#vim syntax on
sed -i "8 s/^/alias vi='vim'/" /root/.bashrc 2>/dev/null
echo 'syntax on' > /root/.vimrc 2>/dev/null
# Disable IPv6 until Cacti at least supports it
echo "alias net-pf-10 off" >> /etc/modprobe.conf
echo "alias ipv6 off" >> /etc/modprobe.conf

#init_ssh
ssh_cf="/etc/ssh/sshd_config"
sed -i -e '74 s/^/#/' -i -e '76 s/^/#/' $ssh_cf
sed -i "s/#UseDNS yes/UseDNS no/" $ssh_cf

# Disable unused service
chkconfig ip6tables off
chkconfig gpm off

# file descriptors
ulimit -HSn 65535
echo -ne "
* soft nofile 65535
* hard nofile 65536
" >>/etc/security/limits.conf

# default useradd
###  mysql ###
groupadd mysql -g 27
useradd -g mysql mysql -u 27  -s /bin/false 

### nginx (www) ###
groupadd  www -g 600  
useradd -g  www www  -u 600  -s /bin/nologin 

### basic dirs ###
### mysql ###
mkdir -p /data/mysql 
mkdir -p /data/logs/mysql/tmp 
chown -R mysql:mysql /data/mysql  
chown -R mysql:mysql  /data/logs/mysql
chmod 777 /data/logs/mysql/tmp

### nginx ###
mkdir -p /data/www/haodou
chown -R www:www /data/www
